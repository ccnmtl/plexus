{% extends 'base.html' %}
{% load markup plexustags %}

{% block content %}

<h1>Server: {{ server.name }}</h1>

<table class="table table-striped table-condensed table-bordered">
    <tr>
        <td>Environment</td>
        <td>{{server.d.environment}}</td>
    </tr>
    <tr>
        <td>Roles</td>
        <td>{% for r in server.d.roles %}{{r}}{% if not forloop.last%}, {% endif %}{% endfor %}</td>
    </tr>
    <tr>
        <td>IP</td>
        <td><code>{{server.d.ipv4.1}}</code> [<code>{{server.d.hwaddr_interfaces.eth0}}</code>]</td></code></td>
    </tr>
    <tr>
        <td>Location</td>
        <td>{% if server.d.ec2 %}EC2{% endif %}</td>
    </tr>
    <tr>
        <td>OS</td>
        <td>{{server.d.osfullname}} {{server.d.osrelease}}</td>
    </tr>
</table>

{% if server.d.apps|length > 0 %}
    <h2>Applications</h2>
    <ul>
        {% for app_name in server.d.apps|dictsort:0 %}
            <li>
            {% app_by_graphite_name app_name as app %}
            {% if app %}
                <a href="{% url 'application-detail' app.id %}">{{app}}</a>
            {% else %}
                {{app_name}}
            {% endif %}
            </li>
        {% endfor %}
    </ul>
{% endif %}

{% aliases server.name as aliases %}
{% if aliases|length > 0 %}
    <h2>Aliases</h2>
    <table class="table table-striped table-condensed table-bordered">
        <thead>
            <tr>
                <th>alias</th>
                <th>description</th>
            </tr>
        </thead>

        <tbody>
            {% for alias in aliases %}
                <tr class="{{alias.status_css_class}}">
                    <td><a href="/alias/{{alias.id}}/">{{alias.hostname}}</a></td>
                    <td>{{alias.description}}</td>
                </tr>
            {% endfor %}
            </tbody>
    </table>
{% endif %}

<h2>Graphs</h2>
{% with graphite_base="https://graphite.ctl.columbia.edu/render/" %}
{% with graphite_name=server.name %}
{% with width=900 height=200 %}
<ul class="nav nav-tabs">
  <li><a href="#daily" data-toggle="tab">Daily</a></li>
  <li><a href="#weekly" data-toggle="tab">Weekly</a></li>
  <li><a href="#monthly" data-toggle="tab">Monthly</a></li>
  <li><a href="#yearly" data-toggle="tab">Yearly</a></li>
</ul>

<div class="tab-content">
  <div class="tab-pane active" id="daily">
{% with from="-24hours" %}
    {% include "main/server_graphs.html" %}
{% endwith %}
  </div>
  <div class="tab-pane" id="weekly">
{% with from="-7days" %}
    {% include "main/server_graphs.html" %}
{% endwith %}
  </div>
  <div class="tab-pane" id="monthly">
{% with from="-4weeks" %}
    {% include "main/server_graphs.html" %}
{% endwith %}
  </div>
  <div class="tab-pane" id="yearly">
{% with from="-1years" %}
    {% include "main/server_graphs.html" %}
{% endwith %}
  </div>
</div>
{% endwith %}
{% endwith %}
{% endwith %}

<h2>Grain Info</h2>
<table class="table table-striped table-condensed table-bordered">
    {% for key, value in server.d.items %}</td>
        <tr>
            <td>{{key}}</td>
            <td>{{value}}</td>
        </tr>
    {% endfor %}
</table>
{% endblock %}