{% extends 'base.html' %}

{% block content %}

<h1>Server: {{server.name}}</h1>
<table class="table table-striped table-condensed table-bordered">
	<tr>
		<th>primary function</th>
		<td>{{server.primary_function}}</td>
	</tr>
	<tr><th>ip addresses</th>
		<td>
			{% for ip in server.ipaddress_set.all %}
			{{ip.ipv4}}
			{% endfor %}
</td></tr>
	<tr><th>location</th><td>{% if server.virtual %}
				[Virtual: {% for vm in server.dom_u.all %}<a href="/server/{{vm.dom_0.id}}">{{vm.dom_0.name}}</a>{% endfor %}]
				{% else %}
				{{server.location.name}}
				{% endif %}</td></tr>
	<tr><th>OS</th><td>{{server.operating_system.family.name}}
				{{server.operating_system.version}}</td></tr>
	<tr><th>mem</th><td>{{server.memory}} [{{server.swap}}]</td></tr>
	<tr><th>disk</th><td>{{server.disk}}</td></tr>
	<tr><th>notes</th><td>{{server.notes}}</td></tr>
</table>

{% if server.dom_0.count %}
<h2>DomU's</h2>
<ul>
{% for vm in server.dom_0.all %}
<li><a href="/server/{{vm.dom_u.id}}/">{{vm.dom_u.name}}</a></li>
{% endfor %}
</ul>
{% endif %}


<h2>Aliases</h2>
{% if request.user.is_staff %}
{% if server.ipaddress_set.count %}

<a href="#addAlias" role="button" class="btn" data-toggle="modal">Add Alias for {{server.name}}</a>
 
	<form action="add_alias/" method="post">
		<div class="modal hide" id="addAlias" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
  <div class="modal-header">
    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
    <h3 id="myModalLabel">Add Alias for {{server.name}}</h3>
  </div>
  <div class="modal-body">
		<label>Hostname
		<input type="text" name="hostname" placeholder="hostname" /></label>
		{% ifequal server.ipaddress_set.count 1 %}
		{% else %}
		<label>IP Address
			<select name="ipaddress">
				{% for ipaddress in server.ipaddress_set.all %}
				<option value="{{ipaddress.id}}">{{ipaddress.ipv4}}</option>
				{% endfor %}
			</select>
		</label>
		{% endifequal %}
		<label>Description
		<textarea name="description" class="input-xxlarge">
		</textarea></label>
		<label>Primary Contact
			<input type="text" name="contact"
						 value="{{request.user.first_name}}" />
		</label>
  </div>
  <div class="modal-footer">
    <button class="btn" data-dismiss="modal" aria-hidden="true">Close</button>
    <button class="btn btn-primary">Add Alias</button>
  </div>
</div>
	</form>

<a href="#requestAlias" role="button" class="btn" data-toggle="modal">Request new Alias for {{server.name}}</a>

	<form action="request_alias/" method="post">
		<div class="modal hide" id="requestAlias" tabindex="-1" role="dialog" aria-labelledby="myModalLabel1" aria-hidden="true">
  <div class="modal-header">
    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
    <h3 id="myModalLabel1">Request New Alias for {{server.name}}</h3>
  </div>
  <div class="modal-body">
		<p class="info">This will send an email to hostmaster with the
		request. It may take a couple business days for the request to go
		through. Once it does, please come back and update the status of
		this alias from 'pending' to 'active'. </p>
			
		<label>Hostname
		<input type="text" name="hostname" placeholder="hostname" /></label>
		{% ifequal server.ipaddress_set.count 1 %}
		{% else %}
		<label>IP Address
			<select name="ipaddress">
				{% for ipaddress in server.ipaddress_set.all %}
				<option value="{{ipaddress.id}}">{{ipaddress.ipv4}}</option>
				{% endfor %}
			</select>
		</label>
		{% endifequal %}
		<label>Description
		<textarea name="description" class="input-xxlarge"></textarea></label>
		<label>Primary Contact
			<input type="text" name="contact"
						 value="{{request.user.first_name}}" />
		</label>
  </div>
  <div class="modal-footer">
    <button class="btn" data-dismiss="modal" aria-hidden="true">Close</button>
    <button class="btn btn-primary">Request Alias</button>
  </div>
</div>
	</form>


{% else %}
<p>Can not add aliases for a server with no IP addresses listed</p>
{% endif %}
{% endif %}


<table class="table table-striped table-condensed table-bordered">
	<thead>
		<tr>
			<th>alias</th>
			<th>description</th>
			<th>contacts</th>
		</tr>
	</thead>
		
	<tbody>

{% for ipaddress in server.ipaddress_set.all %}
{% for alias in ipaddress.alias_set.all %}
		<tr class="{{alias.status_css_class}}">
			<th>{{alias.hostname}}</th>
			<td>{{alias.description}}</td>
			<td>
				{% for ac in alias.aliascontact_set.all %}
				{{ac.contact.name}}
				{% endfor %}
			</td>
		</tr>


{% endfor %}
{% endfor %}
</tbody>
</table>

{% endblock %}


