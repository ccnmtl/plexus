{% extends 'base.html' %}

{% block content %}

<h1>Server: {{server.name}}</h1>
<table class="table table-striped table-condensed table-bordered">
	<tr>
		<td>primary function</td>
		<td>{{server.primary_function}}</td>
	</tr>
	<tr><td>ip addresses</td>
		<td>
			{% for ip in server.ipaddress_set.all %}
			<code>{{ip.ipv4}}</code>{% if ip.mac_addr %} [<code>{{ip.mac_addr}}</code>]{% endif %}
			{% endfor %}
</td></tr>
	<tr><td>location</td><td>{% if server.virtual %}
				[Virtual: {% for vm in server.dom_u.all %}<a href="/server/{{vm.dom_0.id}}">{{vm.dom_0.name}}</a>{% endfor %}]
				{% else %}
				{{server.location.name}}
				{% endif %}</td></tr>
	<tr><td>OS</td><td>{{server.operating_system.family.name}}
				{{server.operating_system.version}}</td></tr>
	<tr><td>mem</td><td>{{server.memory}} [{{server.swap}}]</td></tr>
	<tr><td>disk</td><td>{{server.disk}}</td></tr>
	<tr><td>notes</td><td>{{server.notes}}</td></tr>
</table>

{% if server.dom_0.count %}
<h2>DomU's</h2>
<ul>
{% for vm in server.dom_0.all %}
<li><a href="/server/{{vm.dom_u.id}}/">{{vm.dom_u.name}}</a></li>
{% endfor %}
</ul>
{% endif %}


<h2>Aliases</h2>
{% if request.user.is_staff %}
{% if server.ipaddress_set.count %}

<a href="#addAlias" role="button" class="btn" data-toggle="modal">Add Alias for {{server.name}}</a>
 
	<form action="add_alias/" method="post">
		<div class="modal hide" id="addAlias" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
  <div class="modal-header">
    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
    <h3 id="myModalLabel">Add Alias for {{server.name}}</h3>
  </div>
  <div class="modal-body">
		<label>Hostname
		<input type="text" name="hostname" placeholder="hostname" /></label>
		{% ifequal server.ipaddress_set.count 1 %}
		{% else %}
		<label>IP Address
			<select name="ipaddress">
				{% for ipaddress in server.ipaddress_set.all %}
				<option value="{{ipaddress.id}}">{{ipaddress.ipv4}}</option>
				{% endfor %}
			</select>
		</label>
		{% endifequal %}
		<label>Description
		<textarea name="description" class="input-xxlarge">
		</textarea></label>
		<label>Primary Contact
			<input type="text" name="contact"
						 value="{{request.user.first_name}}" />
		</label>
  </div>
  <div class="modal-footer">
    <button class="btn" data-dismiss="modal" aria-hidden="true">Close</button>
    <button class="btn btn-primary">Add Alias</button>
  </div>
</div>
	</form>

<a href="#requestAlias" role="button" class="btn" data-toggle="modal">Request new Alias for {{server.name}}</a>

	<form action="request_alias/" method="post">
		<div class="modal hide" id="requestAlias" tabindex="-1" role="dialog" aria-labelledby="myModalLabel1" aria-hidden="true">
  <div class="modal-header">
    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
    <h3 id="myModalLabel1">Request New Alias for {{server.name}}</h3>
  </div>
  <div class="modal-body">
		<p class="info">This will send an email to hostmaster with the
		request. It may take a couple business days for the request to go
		through. Once it does, please come back and update the status of
		this alias from 'pending' to 'active'. </p>
			
		<label>Hostname
		<input type="text" name="hostname" placeholder="hostname" /></label>
		{% ifequal server.ipaddress_set.count 1 %}
		{% else %}
		<label>IP Address
			<select name="ipaddress">
				{% for ipaddress in server.ipaddress_set.all %}
				<option value="{{ipaddress.id}}">{{ipaddress.ipv4}}</option>
				{% endfor %}
			</select>
		</label>
		{% endifequal %}
		<label>Description
		<textarea name="description" class="input-xxlarge"></textarea></label>
		<label>Primary Contact
			<input type="text" name="contact"
						 value="{{request.user.first_name}}" />
		</label>
  </div>
  <div class="modal-footer">
    <button class="btn" data-dismiss="modal" aria-hidden="true">Close</button>
    <button class="btn btn-primary">Request Alias</button>
  </div>
</div>
	</form>


{% else %}
<p>Can not add aliases for a server with no IP addresses listed</p>
{% endif %}
{% endif %}


<table class="table table-striped table-condensed table-bordered">
	<thead>
		<tr>
			<th>alias</th>
			<th>description</th>
			<th>contacts</th>
		</tr>
	</thead>
		
	<tbody>

{% for ipaddress in server.ipaddress_set.all %}
{% for alias in ipaddress.alias_set.all %}
		<tr class="{{alias.status_css_class}}">
			<td><a href="/alias/{{alias.id}}/">{{alias.hostname}}</a></td>
			<td>{{alias.description}}</td>
			<td>
				{% for ac in alias.aliascontact_set.all %}
				{{ac.contact.name}}
				{% endfor %}
			</td>
		</tr>


{% endfor %}
{% endfor %}
</tbody>
</table>


{% if server.graphite_name %}
<h2>Graphs</h2>
<ul class="nav nav-tabs">
  <li><a href="#daily" data-toggle="tab">Daily</a></li>
  <li><a href="#weekly" data-toggle="tab">Weekly</a></li>
  <li><a href="#monthly" data-toggle="tab">Monthly</a></li>
  <li><a href="#yearly" data-toggle="tab">Yearly</a></li>
</ul>

<div class="tab-content">
  <div class="tab-pane active" id="daily">

<h3>Load Avg (x10)</h3>
<img src="{{settings.GRAPHITE_BASE}}render/?width=1000&height=200&_salt=1337976132.743&target=summarize(ccnmtl.server.{{server.graphite_name}}.cpu.load_average.1_minute,'15min')&hideGrid=true&hideLegend=true&bgcolor=FFFFFF&fgcolor=000000" />
<h3>Free Memory (%)</h3>
<img src="{{settings.GRAPHITE_BASE}}render/?width=1000&height=200&_salt=1337976132.743&target=ccnmtl.server.{{server.graphite_name}}.memory.MemFree.percent&hideGrid=true&hideLegend=true&bgcolor=FFFFFF&fgcolor=000000" />
<h3>Network Traffic</h3>
<img src="{{settings.GRAPHITE_BASE}}render/?width=1000&height=200&_salt=1337976132.743&target=nonNegativeDerivative(ccnmtl.server.{{server.graphite_name}}.network.eth0.receive.byte_count)&target=nonNegativeDerivative(ccnmtl.server.{{server.graphite_name}}.network.eth0.transmit.byte_count)&hideGrid=true&hideLegend=false&bgcolor=FFFFFF&fgcolor=000000" />
<h3>Swap Activity</h3>
<img src="{{settings.GRAPHITE_BASE}}render/?width=1000&height=200&_salt=1337976132.743&target=nonNegativeDerivative(ccnmtl.server.{{server.graphite_name}}.vmstat.swap.in)&target=nonNegativeDerivative(ccnmtl.server.{{server.graphite_name}}.vmstat.swap.out)&hideGrid=true&hideLegend=false&bgcolor=FFFFFF&fgcolor=000000" />



</div>
  <div class="tab-pane" id="weekly">
<h3>Load Avg (x10)</h3>
<img src="{{settings.GRAPHITE_BASE}}render/?width=1000&height=200&_salt=1337976132.743&target=summarize(ccnmtl.server.{{server.graphite_name}}.cpu.load_average.1_minute,'1h')&hideGrid=true&hideLegend=true&bgcolor=FFFFFF&fgcolor=000000&from=-7days" />
<h3>Free Memory (%)</h3>
<img src="{{settings.GRAPHITE_BASE}}render/?width=1000&height=200&_salt=1337976132.743&target=ccnmtl.server.{{server.graphite_name}}.memory.MemFree.percent&hideGrid=true&hideLegend=true&bgcolor=FFFFFF&fgcolor=000000&from=-7days" />
<h3>Network Traffic</h3>
<img src="{{settings.GRAPHITE_BASE}}render/?width=1000&height=200&_salt=1337976132.743&target=nonNegativeDerivative(ccnmtl.server.{{server.graphite_name}}.network.eth0.receive.byte_count)&target=nonNegativeDerivative(ccnmtl.server.{{server.graphite_name}}.network.eth0.transmit.byte_count)&hideGrid=true&hideLegend=false&bgcolor=FFFFFF&fgcolor=000000&from=-7days" />
<h3>Swap Activity</h3>
<img src="{{settings.GRAPHITE_BASE}}render/?width=1000&height=200&_salt=1337976132.743&target=nonNegativeDerivative(ccnmtl.server.{{server.graphite_name}}.vmstat.swap.in)&target=nonNegativeDerivative(ccnmtl.server.{{server.graphite_name}}.vmstat.swap.out)&hideGrid=true&hideLegend=false&bgcolor=FFFFFF&fgcolor=000000&from=-7days" />

</div>
  <div class="tab-pane" id="monthly">
<h3>Load Avg (x10)</h3>
<img src="{{settings.GRAPHITE_BASE}}render/?width=1000&height=200&_salt=1337976132.743&target=summarize(ccnmtl.server.{{server.graphite_name}}.cpu.load_average.1_minute,'6h')&hideGrid=true&hideLegend=true&bgcolor=FFFFFF&fgcolor=000000&from=-1months" />
<h3>Free Memory (%)</h3>
<img src="{{settings.GRAPHITE_BASE}}render/?width=1000&height=200&_salt=1337976132.743&target=ccnmtl.server.{{server.graphite_name}}.memory.MemFree.percent&hideGrid=true&hideLegend=true&bgcolor=FFFFFF&fgcolor=000000&from=-1months" />
<h3>Network Traffic</h3>
<img src="{{settings.GRAPHITE_BASE}}render/?width=1000&height=200&_salt=1337976132.743&target=nonNegativeDerivative(ccnmtl.server.{{server.graphite_name}}.network.eth0.receive.byte_count)&target=nonNegativeDerivative(ccnmtl.server.{{server.graphite_name}}.network.eth0.transmit.byte_count)&hideGrid=true&hideLegend=false&bgcolor=FFFFFF&fgcolor=000000&from=-1months" />
<h3>Swap Activity</h3>
<img src="{{settings.GRAPHITE_BASE}}render/?width=1000&height=200&_salt=1337976132.743&target=nonNegativeDerivative(ccnmtl.server.{{server.graphite_name}}.vmstat.swap.in)&target=nonNegativeDerivative(ccnmtl.server.{{server.graphite_name}}.vmstat.swap.out)&hideGrid=true&hideLegend=false&bgcolor=FFFFFF&fgcolor=000000&from=-1months" />

</div>
  <div class="tab-pane" id="yearly">

<h3>Load Avg (x10)</h3>
<img src="{{settings.GRAPHITE_BASE}}render/?width=1000&height=200&_salt=1337976132.743&target=summarize(ccnmtl.server.{{server.graphite_name}}.cpu.load_average.1_minute,'1d')&hideGrid=true&hideLegend=true&bgcolor=FFFFFF&fgcolor=000000&from=-1years" />
<h3>Free Memory (%)</h3>
<img src="{{settings.GRAPHITE_BASE}}render/?width=1000&height=200&_salt=1337976132.743&target=ccnmtl.server.{{server.graphite_name}}.memory.MemFree.percent&hideGrid=true&hideLegend=true&bgcolor=FFFFFF&fgcolor=000000&from=-1years" />
<h3>Network Traffic</h3>
<img src="{{settings.GRAPHITE_BASE}}render/?width=1000&height=200&_salt=1337976132.743&target=nonNegativeDerivative(ccnmtl.server.{{server.graphite_name}}.network.eth0.receive.byte_count)&target=nonNegativeDerivative(ccnmtl.server.{{server.graphite_name}}.network.eth0.transmit.byte_count)&hideGrid=true&hideLegend=false&bgcolor=FFFFFF&fgcolor=000000&from=-1years" />
<h3>Swap Activity</h3>
<img src="{{settings.GRAPHITE_BASE}}render/?width=1000&height=200&_salt=1337976132.743&target=nonNegativeDerivative(ccnmtl.server.{{server.graphite_name}}.vmstat.swap.in)&target=nonNegativeDerivative(ccnmtl.server.{{server.graphite_name}}.vmstat.swap.out)&hideGrid=true&hideLegend=false&bgcolor=FFFFFF&fgcolor=000000&from=-1years" />

</div>
</div>
{% endif %}


{% endblock %}


