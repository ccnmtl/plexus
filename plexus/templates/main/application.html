{% extends 'base.html' %}
{% load feeds %}

{% block content %}

<h1>Application: {{application.name}}</h1>
{% if request.user.is_staff %}
<a href="/admin/main/application/{{application.id}}/">edit</a>
{% endif %}

<table class="table table-striped table-condensed table-bordered">
	<tr>
		<td>description</td>
		<td>{{application.description}}</td>
	</tr>
	<tr><td>technology</td><td>{{application.technology.name}}</td></tr>
	{% if application.pmt_id %}
	<tr>
		<td>PMT</td>
		<td>
			<a href="http://pmt.ccnmtl.columbia.edu/home.pl?mode=project;pid={{application.pmt_id}}">Project Page</a>
			[<a href="http://pmt.ccnmtl.columbia.edu/home.pl?mode=add_item_form;type=bug;pid={{application.pmt_id}}">report bug</a>]
			[<a href="http://pmt.ccnmtl.columbia.edu/home.pl?mode=add_item_form;type=action;pid={{application.pmt_id}}">add
			action item</a>]
		</td>
	</tr>
	{% endif %}
	{% if application.sentry_name %}
	<tr>
		<td>Sentry</td>
		<td><a href="http://sentry.ccnmtl.columbia.edu/sentry/?server_name=&amp;site={{application.sentry_name}}">View Errors</a></td>
	</tr>
	{% endif %}
</table>

{% if application.applicationalias_set.count %}
<h2>Alias(es)</h2>
<ul>
{% for aa in application.applicationalias_set.all %}
<li><a href="/alias/{{aa.alias.id}}/">{{aa.alias.hostname}}</a></li>
{% endfor %}
</ul>
{% endif %}


{% if application.graphite_name %}
<h2>Graphs</h2>
<ul class="nav nav-tabs">
  <li><a href="#daily" data-toggle="tab">Daily</a></li>
  <li><a href="#weekly" data-toggle="tab">Weekly</a></li>
  <li><a href="#monthly" data-toggle="tab">Monthly</a></li>
  <li><a href="#yearly" data-toggle="tab">Yearly</a></li>
</ul>

<div class="tab-content">
{% with hidegrid='false' %}
{% with bgcolor='FFFFFF' %}
{% with fgcolor='999999' %}
{% with width='1000' %}
{% with height='200' %}


  <div class="tab-pane active" id="daily">


{% with summarize='15min' %}
<h3>Traffic</h3>
<img src="{{settings.GRAPHITE_BASE}}render/?width={{width}}&height={{height}}&_salt=1337976132.743&target=summarize(ccnmtl.app.counters.{{application.graphite_name}}.response.200,'{{summarize}}')&hideGrid={{hidegrid}}&hideLegend=true&bgcolor={{bgcolor}}&fgcolor={{fgcolor}}" width="{{width}}" height="{{height}}" />
<h3>Response Times (max/mean/min)</h3>
<img src="{{settings.GRAPHITE_BASE}}render/?width={{width}}&height={{height}}&_salt=1337976132.743&target=summarize(keepLastValue(ccnmtl.app.timers.{{application.graphite_name}}.view.GET.lower),'{{summarize}}')&target=summarize(keepLastValue(ccnmtl.app.timers.{{application.graphite_name}}.view.GET.mean),'{{summarize}}')&target=summarize(keepLastValue(ccnmtl.app.timers.{{application.graphite_name}}.view.GET.upper),'{{summarize}}')&hideGrid={{hidegrid}}&hideLegend=true&bgcolor={{bgcolor}}&fgcolor={{fgcolor}}" width="{{width}}" height="{{height}}" />
<h3>Errors</h3>
<img src="{{settings.GRAPHITE_BASE}}render/?width={{width}}&height={{height}}&_salt=1337976132.743&target=summarize(ccnmtl.app.counters.{{application.graphite_name}}.response.500,'{{summarize}}')&target=summarize(ccnmtl.app.counters.{{application.graphite_name}}.response.404,'{{summarize}}')&hideGrid={{hidegrid}}&hideLegend=true&bgcolor={{bgcolor}}&fgcolor={{fgcolor}}" width="{{width}}" height="{{height}}" />
{% endwith %}
</div>

  <div class="tab-pane" id="weekly">
{% with period="-7days" %}
{% with summarize='1h' %}
<h3>Traffic</h3>
<img src="{{settings.GRAPHITE_BASE}}render/?width={{width}}&height={{height}}&_salt=1337976132.743&target=summarize(ccnmtl.app.counters.{{application.graphite_name}}.response.200,'{{summarize}}')&hideGrid={{hidegrid}}&hideLegend=true&bgcolor={{bgcolor}}&fgcolor={{fgcolor}}&from={{period}}" width="{{width}}" height="{{height}}" />
<h3>Response Times (max/mean/min)</h3>
<img src="{{settings.GRAPHITE_BASE}}render/?width={{width}}&height={{height}}&_salt=1337976132.743&target=summarize(keepLastValue(ccnmtl.app.timers.{{application.graphite_name}}.view.GET.lower),'{{summarize}}')&target=summarize(keepLastValue(ccnmtl.app.timers.{{application.graphite_name}}.view.GET.mean),'{{summarize}}')&target=summarize(keepLastValue(ccnmtl.app.timers.{{application.graphite_name}}.view.GET.upper),'{{summarize}}')&hideGrid={{hidegrid}}&hideLegend=true&bgcolor={{bgcolor}}&fgcolor={{fgcolor}}&from={{period}}" width="{{width}}" height="{{height}}" />
<h3>Errors</h3>
<img src="{{settings.GRAPHITE_BASE}}render/?width={{width}}&height={{height}}&_salt=1337976132.743&target=summarize(ccnmtl.app.counters.{{application.graphite_name}}.response.500,'{{summarize}}')&target=summarize(ccnmtl.app.counters.{{application.graphite_name}}.response.404,'{{summarize}}')&hideGrid={{hidegrid}}&hideLegend=true&bgcolor={{bgcolor}}&fgcolor={{fgcolor}}" width="{{width}}" height="{{height}}&from={{period}}" />
{% endwith %}
{% endwith %}
</div>

  <div class="tab-pane" id="monthly">
{% with period="-1months" %}
{% with summarize='6h' %}
<h3>Traffic</h3>
<img src="{{settings.GRAPHITE_BASE}}render/?width={{width}}&height={{height}}&_salt=1337976132.743&target=summarize(ccnmtl.app.counters.{{application.graphite_name}}.response.200,'{{summarize}}')&hideGrid={{hidegrid}}&hideLegend=true&bgcolor={{bgcolor}}&fgcolor={{fgcolor}}&from={{period}}" width="{{width}}" height="{{height}}" />
<h3>Response Times (max/mean/min)</h3>
<img src="{{settings.GRAPHITE_BASE}}render/?width={{width}}&height={{height}}&_salt=1337976132.743&target=summarize(keepLastValue(ccnmtl.app.timers.{{application.graphite_name}}.view.GET.lower),'{{summarize}}')&target=summarize(keepLastValue(ccnmtl.app.timers.{{application.graphite_name}}.view.GET.mean),'{{summarize}}')&target=summarize(keepLastValue(ccnmtl.app.timers.{{application.graphite_name}}.view.GET.upper),'{{summarize}}')&hideGrid={{hidegrid}}&hideLegend=true&bgcolor={{bgcolor}}&fgcolor={{fgcolor}}&from={{period}}" width="{{width}}" height="{{height}}" />
<h3>Errors</h3>
<img src="{{settings.GRAPHITE_BASE}}render/?width={{width}}&height={{height}}&_salt=1337976132.743&target=summarize(ccnmtl.app.counters.{{application.graphite_name}}.response.500,'{{summarize}}')&target=summarize(ccnmtl.app.counters.{{application.graphite_name}}.response.404,'{{summarize}}')&hideGrid={{hidegrid}}&hideLegend=true&bgcolor={{bgcolor}}&fgcolor={{fgcolor}}&from={{period}}" width="{{width}}" height="{{height}}" />
{% endwith %}
{% endwith %}

</div>
  <div class="tab-pane" id="yearly">

{% with period='-1years' %}
{% with summarize='1d' %}
<h3>Traffic</h3>
<img src="{{settings.GRAPHITE_BASE}}render/?width={{width}}&height={{height}}&_salt=1337976132.743&target=summarize(ccnmtl.app.counters.{{application.graphite_name}}.response.200,'{{summarize}}')&hideGrid={{hidegrid}}&hideLegend=true&bgcolor={{bgcolor}}&fgcolor={{fgcolor}}&from={{period}}" width="{{width}}" height="{{height}}" />
<h3>Response Times (max/mean/min)</h3>
<img src="{{settings.GRAPHITE_BASE}}render/?width={{width}}&height={{height}}&_salt=1337976132.743&target=summarize(keepLastValue(ccnmtl.app.timers.{{application.graphite_name}}.view.GET.lower),'{{summarize}}')&target=summarize(keepLastValue(ccnmtl.app.timers.{{application.graphite_name}}.view.GET.mean),'{{summarize}}')&target=summarize(keepLastValue(ccnmtl.app.timers.{{application.graphite_name}}.view.GET.upper),'{{summarize}}')&hideGrid={{hidegrid}}&hideLegend=true&bgcolor={{bgcolor}}&fgcolor={{fgcolor}}&from={{period}}" width="{{width}}" height="{{height}}" />
<h3>Errors</h3>
<img src="{{settings.GRAPHITE_BASE}}render/?width={{width}}&height={{height}}&_salt=1337976132.743&target=summarize(ccnmtl.app.counters.{{application.graphite_name}}.response.500,'{{summarize}}')&target=summarize(ccnmtl.app.counters.{{application.graphite_name}}.response.404,'{{summarize}}')&hideGrid={{hidegrid}}&hideLegend=true&bgcolor={{bgcolor}}&fgcolor={{fgcolor}}&from={{period}}" width="{{width}}" height="{{height}}" />
{% endwith %}
{% endwith %}

</div>

{% endwith %}
{% endwith %}
{% endwith %}
{% endwith %}
{% endwith %}
</div>
{% endif %}

{% if application.pmt_id %}
<h2>Recent PMT Activity</h2>
{% parse_feed application.pmt_feed_url as pmt_feed %}
{% for item in pmt_feed.entries %}
<h4><a href="{{item.link}}">{{item.title}}</a></h4>
{{item.description|safe}}
{% endfor %}


{% endif %}


{% endblock %}

